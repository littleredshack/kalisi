<div class="admin-dashboard">
  <!-- Panel-style header matching other panels -->
  <div class="panel-header">
    <h3>Admin Dashboard</h3>
    <div class="header-actions">
      <button mat-icon-button (click)="exportLogs()" matTooltip="Export Logs">
        <mat-icon>download</mat-icon>
      </button>
      <button mat-icon-button (click)="clearOldLogs()" matTooltip="Clear Old Logs">
        <mat-icon>delete_sweep</mat-icon>
      </button>
    </div>
  </div>

  <!-- Panel content -->
  <div class="panel-content">
    <!-- Metrics Cards -->
    <div class="metrics-grid">
      <div class="metric-card">
        <div class="metric-value">{{ metrics.total_logs }}</div>
        <div class="metric-label">Total Logs</div>
      </div>

      <div class="metric-card error">
        <div class="metric-value">{{ metrics.errors_today }}</div>
        <div class="metric-label">Errors Today</div>
      </div>

      <div class="metric-card warning">
        <div class="metric-value">{{ metrics.warnings_today }}</div>
        <div class="metric-label">Warnings Today</div>
      </div>

      <div class="metric-card">
        <div class="metric-value">{{ metrics.active_sessions }}</div>
        <div class="metric-label">Active Sessions</div>
      </div>

      <div class="metric-card">
        <div class="metric-value">{{ metrics.auth_attempts }}</div>
        <div class="metric-label">Auth Attempts</div>
      </div>

      <div class="metric-card">
        <div class="metric-value">{{ metrics.api_calls }}</div>
        <div class="metric-label">API Calls</div>
      </div>
    </div>

    <!-- Filters -->
    <div class="filters-section">
      <mat-form-field appearance="outline">
        <mat-label>Search</mat-label>
        <input matInput [(ngModel)]="searchText" placeholder="Search logs..." />
        <mat-icon matPrefix>search</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Category</mat-label>
        <mat-select [(ngModel)]="selectedCategory">
          <mat-option *ngFor="let cat of categories" [value]="cat.value">
            {{ cat.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Level</mat-label>
        <mat-select [(ngModel)]="selectedLevel">
          <mat-option *ngFor="let level of levels" [value]="level.value">
            {{ level.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <button mat-raised-button color="primary" (click)="applyFilters()">
        Apply
      </button>
      <button mat-button (click)="clearFilters()">
        Clear
      </button>
    </div>

    <!-- Error message -->
    <div *ngIf="error" class="error-message">
      <mat-icon>error_outline</mat-icon>
      <span>{{ error }}</span>
    </div>

    <!-- Logs Table -->
    <div class="table-container" *ngIf="!initialLoad">
      <table mat-table [dataSource]="logs" class="logs-table">
        
        <!-- Timestamp Column -->
        <ng-container matColumnDef="timestamp">
          <th mat-header-cell *matHeaderCellDef>Timestamp</th>
          <td mat-cell *matCellDef="let log">
            {{ log.timestamp | date:'short' }}
          </td>
        </ng-container>

        <!-- Level Column -->
        <ng-container matColumnDef="level">
          <th mat-header-cell *matHeaderCellDef>Level</th>
          <td mat-cell *matCellDef="let log">
            <span class="log-level" [class]="'level-' + log.level.toLowerCase()">
              {{ log.level }}
            </span>
          </td>
        </ng-container>

        <!-- Category Column -->
        <ng-container matColumnDef="category">
          <th mat-header-cell *matHeaderCellDef>Category</th>
          <td mat-cell *matCellDef="let log">
            {{ log.category }}
          </td>
        </ng-container>

        <!-- Message Column -->
        <ng-container matColumnDef="message">
          <th mat-header-cell *matHeaderCellDef>Message</th>
          <td mat-cell *matCellDef="let log" class="message-cell">
            <span [matTooltip]="log.message">
              {{ log.message | slice:0:100 }}{{ log.message.length > 100 ? '...' : '' }}
            </span>
          </td>
        </ng-container>

        <!-- User Column -->
        <ng-container matColumnDef="user">
          <th mat-header-cell *matHeaderCellDef>User</th>
          <td mat-cell *matCellDef="let log">
            {{ log.user_id || '-' }}
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let log">
            <button mat-icon-button (click)="viewLogDetails(log)" matTooltip="View Details">
              <mat-icon>visibility</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
            [class.error-row]="row.level === 'error' || row.level === 'critical'"
            [class.warning-row]="row.level === 'warn'"></tr>
      </table>

      <div *ngIf="logs.length === 0" class="no-data">
        <mat-icon>inbox</mat-icon>
        <p>No logs found</p>
      </div>
    </div>

    <!-- Initial loading state (minimal, no spinner) -->
    <div *ngIf="initialLoad" class="initial-load">
      <p>Loading logs...</p>
    </div>
  </div>
</div>